<!DOCTYPE html>
<html>
<head>
  <title>Movie-to-Soundtrack Finder</title>

  <style>
    /* ===========================
       GLOBAL STYLES
    =========================== */
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 { color: #00acee; }
    h2 {
      color: #00acee;
      border-bottom: 2px solid #00acee;
      padding-bottom: 5px;
    }

    input {
      padding: 10px;
      width: 250px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      margin-right: 10px;
    }

    button {
      padding: 10px 16px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #00acee;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background-color: #008ec1;
      transform: translateY(-1px);
    }

    /* ===========================
       LAYOUT CARDS & CONTAINERS
    =========================== */
    .container {
      max-width: 900px;
      margin: 40px auto;
      text-align: left;
    }

    .movie-card {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.3);
      display: flex;
      align-items: flex-start;
      gap: 20px;
    }

    .movie-poster {
      width: 200px;
      border-radius: 8px;
    }

    .movie-info { flex: 1; }

    #youtubeResults {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .video-card {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      flex: 1 1 45%;
      min-width: 250px;
      margin-bottom: 10px;
    }

    .video-card p {
      font-size: 14px;
      margin: 0;
      color: #ddd;
      flex: 1;
    }

    iframe {
      width: 160px;
      height: 90px;
      border-radius: 6px;
      border: none;
    }

    footer {
      margin-top: 40px;
      color: #888;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <h1>üé¨ Movie-to-Soundtrack Finder</h1>
  <p>Search any movie.</p>

  <button onclick="window.location.href='browse.html'">Browse Movies</button>
  <input type="text" id="searchBox" placeholder="Enter a movie title...">
  <button onclick="searchMovie()">Search</button>

  <div class="container">
    <div id="movieResults"></div>
  </div>

  <footer>
    Powered by TMDb & YouTube APIs ‚Äî for educational use only
  </footer>

<script>
/* ============================================================
   API KEYS
============================================================ */
const tmdbKey = "71421e241b142b2835dc1fcd3e8e5327";
const ytKey   = "AIzaSyDKLqX_llwkh0y22s7s68m7BGSrQZy3Kcw";

/* ============================================================
   WINDOW ONLOAD HANDLER
============================================================ */
window.onload = () => {
  const params = new URLSearchParams(window.location.search);

  if (params.has("id")) {
      if (params.has("id")) {

  const movie = {
  id: params.get("id"),
  title: decodeURIComponent(params.get("title")),
  overview: decodeURIComponent(params.get("overview")),
  poster: decodeURIComponent(params.get("poster")),
  rating: params.get("rating"),
  release_date: params.get("date")
  };


  // Hide search UI
  document.querySelector("h1").style.display = "none";
  document.querySelector("p").style.display = "none";
  document.getElementById("searchBox").style.display = "none";
  document.querySelectorAll("button")[1].style.display = "none";

  const movieDiv = document.getElementById("movieResults");

  movieDiv.innerHTML = `
  <div class="movie-card" style="display:block">
    
    <button onclick="window.location.href='browse.html'"
      style="margin-bottom: 15px; background:#00acee; border:none; padding:8px 14px; border-radius:6px; color:white;">
      ‚Üê Back
    </button>

    <button onclick="window.location.href='index1.html'"
      style="margin-bottom: 15px; background:#444; border:none; padding:8px 14px; border-radius:6px; color:white; margin-left:10px;">
      üîç Search Again
    </button>

    <img src="${movie.poster}" 
         style="width:260px; border-radius:10px; display:block; margin-bottom:15px;">

    <h2>${movie.title}</h2>

    <p><strong>Release:</strong> ${movie.release_date}</p>

    <p style="font-size:18px; margin:10px 0; color:#FFD700;">
      ‚≠ê ${parseFloat(movie.rating).toFixed(1)} / 10
    </p>

    <p>${movie.overview}</p>

    <h3>üéß Soundtracks</h3>
    <div id="youtubeResults"></div>

  </div>
`;


  getSoundtracks(movie.title);
}
;
  }
};

/* ============================================================
   FETCH HELPER
============================================================ */
async function fetchJSON(url) {
  const res = await fetch(url);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}

/* ============================================================
   BROWSE-MOVIE RENDER
============================================================ */
function showBrowseMovie(params) {
  const movie = {
    id: params.get("id"),
    title: decodeURIComponent(params.get("title")),
    overview: decodeURIComponent(params.get("overview")),
    release_date: params.get("date")
  };

  // Hide search UI
  document.querySelector("h1").style.display = "none";
  document.querySelector("p").style.display = "none";
  document.getElementById("searchBox").style.display = "none";
  document.querySelectorAll("button")[1].style.display = "none";

  const movieDiv = document.getElementById("movieResults");

  movieDiv.innerHTML = `
    <div class="movie-card" style="display:block">
      <button onclick="window.location.href='browse.html'">‚Üê Back</button>
      <button onclick="window.location.href='index1.html'" style="background:#444; margin-left:10px;">
        üîç Search Again
      </button>

      <h2>${movie.title}</h2>
      <p><strong>Release:</strong> ${movie.release_date}</p>
      <p>${movie.overview}</p>

      <h3>üéß Soundtracks</h3>
      <div id="youtubeResults"></div>
    </div>
  `;

  getSoundtracks(movie.title);
}

/* ============================================================
   YOUTUBE SOUNDTRACK LOADER
============================================================ */
async function searchYouTube(q, max = 3) {
  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&maxResults=${max}&type=video&key=${ytKey}`;
  const data = await fetchJSON(url);
  return data.items || [];
}

async function getSoundtracks(title) {
  const ytDiv = document.getElementById("youtubeResults");
  ytDiv.innerHTML = "<p>Loading soundtrack...</p>";

  let results =
    await searchYouTube(`${title} original motion picture soundtrack`) ||
    await searchYouTube(`${title} OST`);

  ytDiv.innerHTML = "";

  if (!results.length) {
    ytDiv.innerHTML = "<p>No soundtrack videos found.</p>";
    return;
  }

  results.forEach(v => {
    ytDiv.innerHTML += `
      <div class="video-card">
        <p>${v.snippet.title}</p>
        <iframe src="https://www.youtube.com/embed/${v.id.videoId}" allowfullscreen></iframe>
      </div>
    `;
  });
}

/* ============================================================
   MOVIE SEARCH
============================================================ */
async function searchMovie() {
  const query = document.getElementById("searchBox").value.trim();
  const movieDiv = document.getElementById("movieResults");
  movieDiv.innerHTML = "";

  if (!query) return movieDiv.innerHTML = "<p>Please type a movie title.</p>";

  try {
    const url = `https://api.themoviedb.org/3/search/movie?api_key=${tmdbKey}&query=${encodeURIComponent(query)}`;
    const data = await fetchJSON(url);

    if (!data.results.length)
      return movieDiv.innerHTML = "<p>No movie found.</p>";

    const movie = data.results[0];

    renderMovie(movie);
    await getTrailer(movie.id);
    await getSoundtracks(movie.title);

  } catch (err) {
    movieDiv.innerHTML = "<p>Error loading movie info.</p>";
  }
}

/* ============================================================
   MOVIE RENDER
============================================================ */
function renderMovie(movie) {
  const poster = movie.poster_path
    ? `https://image.tmdb.org/t/p/w300${movie.poster_path}`
    : "https://via.placeholder.com/300x450?text=No+Poster";

  document.getElementById("movieResults").innerHTML = `
    <div class="movie-card">
      <img src="${poster}" class="movie-poster">
      <div class="movie-info">
        <h2>${movie.title}</h2>
        <p><strong>Release:</strong> ${movie.release_date || "Unknown"}</p>
        <p>${movie.overview || "No description available."}</p>

        <div id="trailerSection"></div>
        <div id="youtubeResults"></div>
      </div>
    </div>
  `;
}

/* ============================================================
   TRAILER LOADER
============================================================ */
async function getTrailer(movieId) {
  const div = document.getElementById("trailerSection");
  div.innerHTML = "<h3>üéûÔ∏è Trailer</h3><p>Loading...</p>";

  try {
    const url = `https://api.themoviedb.org/3/movie/${movieId}/videos?api_key=${tmdbKey}`;
    const data = await fetchJSON(url);

    const trailer = data.results.find(v =>
      v.site === "YouTube" && v.type === "Trailer"
    );

    div.innerHTML = trailer
      ? `<iframe src="https://www.youtube.com/embed/${trailer.key}?modestbranding=1&controls=1" allowfullscreen></iframe>`
      : "<p>No trailer found.</p>";

  } catch {
    div.innerHTML = "<p>Error loading trailer.</p>";
  }
}
</script>
</body>
</html>
