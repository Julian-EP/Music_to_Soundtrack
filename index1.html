<!DOCTYPE html>
<html>
    <head>
        <title> Movie_to_soundtrack

        </title>
    </head>
<body>
    <h2>Type a movie or soundtrack below.

    </h2>
    <input type="text" id="searchBox">
    <button onclick="searchBoth()">Search

    </button>

    <div id="movieResults">

    </div>

    <div id="spotifySoundtrack">

    </div>

<script>
    const tmdbToken = "71421e241b142b2835dc1fcd3e8e5327";
    const spotifyToken = "1POdFZRZbvb...qqillRxMr2z";

    function searchBoth()
    {
        const userResponse = document.getElementById("searchBox").value;
    

        const movieLink = `https://api.themoviedb.org/3/search/movie?api_key=${tmdbToken}&query=${encodeURIComponent(userResponse)}`;

        fetch(movieLink)
            .then(response => response.json())
            .then(data => displayMovie(data))
            .catch(error => {
                console.error("Movie couldn't be found.", error)});
    }

    function displayMovie(data)
                {
                    const movieDis = document.getElementById("movieResults");

                    if(data.results && data.results.length > 0)
                    {
                        for(let i = 0; i < 5; i++)
                        {
                            const movie = data.results[i];
                            movieDis.innerHTML += `<div> <h3>${movie.title}</h3> <p>${movie.overview}</p> <p>${movie.release_date}</p> <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" alt="poster not found"> </div>`;

                        }
                    }
                    else
                    {
                        movieDis.textContent = "Couldn't find movie.";
                    }
                }
                
    const spotifyLink = `https://api.spotify.com/v1/search?q=${encodeURIComponent(movie.title)}&type=track&limit=3`;    
                
    fetch(spotifyLink, {
        headers:{Authorization: `Bearer ${spotifyToken}`}
    })
        .then(response => response.json())
        .then(soundtrackdata => spotifyPreview(soundtrackdata))
        .catch((error) => {console.error("Soundtrack couldn't be found.", error);});
                
    function spotifyPreview(soundtrackdata){
    const previewSoundtrack = document.getElementById("spotifySoundtrack");
                    
    if(soundtrackdata.tracks && soundtrackdata.tracks.items.length > 0)
                {
        const track = soundtrackdata.tracks.items[0];
        const trackName = track.name;
        const previewUrl = track.preview_url;

        previewSoundtrack.innerHTML += `<h3>${trackName}</h3> ${previewUrl ? `<audio controls src ="${previewUrl}"></audio>`: "<p>No preview.</p>"}`;
    }
    else
    {
        previewSoundtrack.textContent = "Soundtrack unavailable.";
    }
    } 

</script>
</body>
</html>